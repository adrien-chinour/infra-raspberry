version: '3.7'
services:
    nginx:
        container_name: nginx
        restart: always
        image: nginx:latest
        depends_on:
            - php
        ports:
            - "7777:80"
        volumes:
            - ./web:/app
            - ./config/default.conf:/etc/nginx/conf.d/default.conf
        networks:
            - lan
            - traefik_network
    php:
        container_name: php
        restart: always
        build: .
        depends_on:
            - postgres
        environment:
            TZ: 'Europe/Paris'
            POSTGRES_HOST: 'postgres'
            POSTGRES_DATABASE: ${POSTGRES_DB}
            POSTGRES_USER: ${POSTGRES_USER}
            POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
            APP_ENV: ${SYMFONY_ENV}
            APP_SECRET: ${SYMFONY_SECRET}
        volumes:
            - ./web:/app
        networks:
            - lan
    postgres:
        container_name: postgres
        restart: always
        image: arm64v8/postgres:13
        environment:
            POSTGRES_DB: ${POSTGRES_DB}
            POSTGRES_USER: ${POSTGRES_USER}
            POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
        volumes:
            - db:/var/lib/postgresql/data/pgdata
        networks:
            - lan

volumes:
    db:

networks:
    traefik_network:
        external: true
    lan:
